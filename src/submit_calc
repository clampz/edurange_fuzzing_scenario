#!/bin/bash

if [ ! $1 == "" ]; then

  if [ ! -e $1 ]; then # if the given calc doesn't exist, error!

    echo "[!!] your calculator filename is invalid."
    exit

  else 	# if the calc exists, run it, and return the output to
	# the scorebot

    cp gdb_script_front run_calc_gdb_script.py.gdb
    echo "file $1" >> run_calc_gdb_script.py.gdb
    cp gdb_script_back gdb_tmp_back
    cat gdb_tmp_back >> run_calc_gdb_script.py.gdb
    rm gdb_tmp_back
    gdb -q -x run_calc_gdb_script.py.gdb >> tmp

    if grep -q 'killed' "./tmp" ; then

      NOW=$(date +%F--%R%p)
      echo ">.< Oh man, your calculator crashed.. -> crash_addr_$NOW.txt"
      cat tmp | grep "0x" > crash_addr_$NOW.txt
      echo "[!!] crashed" | nc 10.0.0.8 2222
      NOW=""
      rm tmp

    else

      NOW=$(date +%F--%R%p)
      echo "OK, Here's your output (also in the file $NOW.txt):"
      # the following eventually should be something more liek: ./$1 > $NOW.txt
      # cat $NOW.txt | nc 10.0.0.8 2222
      cat tmp
      mv tmp $NOW.txt
      NOW=""

    fi

    rm run_calc_gdb_script.py.gdb

  fi

else

  echo "Usage: $0 calculator_filename"

fi

#
# Calc Scenario Scorebot Submition Algorithm --
# 1. see if we were given a calculator, if so - run
# 	some input and send the pair off to the scorebot.
# 	send the output from the calc to the attacking team.
#

